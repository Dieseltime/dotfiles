#!/usr/bin/env bash

# Be lazy as fuck

APPEND_BRANCH=true
EMOJI=""

while test $# -gt 0; do
  case "$1" in
    -n|--no-branchname) APPEND_BRANCH=false
      ;;
    -e|--emoji) EMOJI="$(shuf -n 1 $HOME/.dotfiles/git/.emoji)"
      ;;
    *)
      ;;
  esac
  shift
done

git add -A .
branchname=$(git describe --exact-match --tags 2> /dev/null || git rev-parse --abbrev-ref HEAD)

message=$1

if [ ! -z "${EMOJI// }" ]; then
  message="$EMOJI"
fi

if [ -z "${message// }" ] && [ -z "${EMOJI// }" ]; then
  read -p "Enter a commit message: " message
fi

if [ "$APPEND_BRANCH" = true ]; then
  message="$message -- #$branchname"
fi

echo "Committing: $message"
git commit -m "$message"
git push origin $branchname
