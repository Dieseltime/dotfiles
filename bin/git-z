#!/usr/bin/env bash

# Be lazy as fuck

_APPEND_BRANCH=${GIT_Z_APPEND_BRANCH:-true}
_EMOJI=${GIT_Z_EMOJI:-}

while test $# -gt 0; do
  case "$1" in
    -n|--no-branchname) _APPEND_BRANCH=false
      ;;
    -e|--emoji) _EMOJI="$(shuf -n 1 $HOME/.dotfiles/git/.emoji)"
      ;;
    *)
      ;;
  esac
  shift
done

git add -A .
branchname=$(git describe --exact-match --tags 2> /dev/null || git rev-parse --abbrev-ref HEAD)

message=$1

echo "_EMOJI is: ${_EMOJI}"

if [ ! -z "${_EMOJI// }" ]; then
  message="$_EMOJI"
fi

if [ -z "${message// }" ] && [ -z "${_EMOJI// }" ]; then
  read -p "Enter a commit message: " message
fi

if [ "$_APPEND_BRANCH" = true ]; then
  message="$message -- #$branchname"
fi

echo "Committing: $message"
git commit -m "$message"
git push origin $branchname
