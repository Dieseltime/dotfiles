#!/usr/bin/env bash

# Be lazy as fuck

BRANCH=${GIT_Z_APPEND_BRANCH:-true}
EMOJI=${GIT_Z_EMOJI:-}

while [[ $# > 1 ]]; do
  key="$1"
  case "$key" in
    -n|--no-branchname) BRANCH=false
      shift
      ;;
    -e|--emoji) EMOJI="$(shuf -n 1 $HOME/.dotfiles/git/.emoji)"
      shift
      ;;
    *)
      ;;
  esac
done

git add -A .

MESSAGE=$1

if [ -n "$EMOJI" ]; then
  MESSAGE="$EMOJI"
fi

if [ -z "${MESSAGE// }" ] && [ -z "$EMOJI" ]; then
  read -p "Enter a commit message: " MESSAGE
fi

if [ "$BRANCH" = true ]; then
  BRANCH=$(git describe --exact-match --tags 2> /dev/null || git rev-parse --abbrev-ref HEAD)
  MESSAGE="$MESSAGE -- #$BRANCH"
fi

echo "Committing: $MESSAGE"
git commit -m "$MESSAGE"
git push origin $BRANCH
